<Measure xmlns="http://hl7.org/fhir">
   <id value="BedCapacityMeasure"></id>
   <meta>
      <profile value="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/computable-measure-cqfm"></profile>
   </meta>
   <contained>
      <Library xmlns="http://hl7.org/fhir">
         <id value="effective-data-requirements"></id>
         <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-directReferenceCode">
            <valueCoding>
               <system value="http://terminology.hl7.org/CodeSystem/location-physical-type"></system>
               <code value="bd"></code>
               <display value="Bed"></display>
            </valueCoding>
         </extension>
         <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-directReferenceCode">
            <valueCoding>
               <system value="http://hl7.org/fhir/us/safr/CodeSystem/us-safr-bed-capacity-example-codes"></system>
               <code value="HOSP"></code>
               <display value="Hospital"></display>
            </valueCoding>
         </extension>
         <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-directReferenceCode">
            <valueCoding>
               <system value="http://hl7.org/fhir/us/safr/CodeSystem/us-safr-bed-capacity-example-codes"></system>
               <code value="IRF"></code>
               <display value="Inpatient Rehabilitation"></display>
            </valueCoding>
         </extension>
         <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-directReferenceCode">
            <valueCoding>
               <system value="http://hl7.org/fhir/us/safr/CodeSystem/us-safr-bed-capacity-example-codes"></system>
               <code value="IPF"></code>
               <display value="Inpatient Psychiatric"></display>
            </valueCoding>
         </extension>
         <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-directReferenceCode">
            <valueCoding>
               <system value="http://hl7.org/fhir/us/safr/CodeSystem/us-safr-bed-capacity-example-codes"></system>
               <code value="OTH"></code>
               <display value="Other facility-within-facility or subunit"></display>
            </valueCoding>
         </extension>
         <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-directReferenceCode">
            <valueCoding>
               <system value="http://hl7.org/fhir/us/safr/CodeSystem/us-safr-bed-capacity-example-codes"></system>
               <code value="CHLD"></code>
               <display value="Children's or Pediatric"></display>
            </valueCoding>
         </extension>
         <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition">
            <extension url="libraryName">
               <valueString value="BedCapacityMeasure"></valueString>
            </extension>
            <extension url="name">
               <valueString value="Bed Initial Population"></valueString>
            </extension>
            <extension url="statement">
               <valueString value="define &quot;Bed Initial Population&quot;:
  Location.physicalType ~ &quot;Bed&quot;"></valueString>
            </extension>
            <extension url="displaySequence">
               <valueInteger value="0"></valueInteger>
            </extension>
         </extension>
         <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition">
            <extension url="libraryName">
               <valueString value="BedCapacityMeasure"></valueString>
            </extension>
            <extension url="name">
               <valueString value="Occupation Stratification"></valueString>
            </extension>
            <extension url="statement">
               <valueString value="// Occupied Stratifier
define &quot;Occupation Stratification&quot;:
  if &quot;Has Qualifying Encounter at Location&quot;
    then 'Occupied'
  else 'Not Occupied'"></valueString>
            </extension>
            <extension url="displaySequence">
               <valueInteger value="1"></valueInteger>
            </extension>
         </extension>
         <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition">
            <extension url="libraryName">
               <valueString value="BedCapacityMeasure"></valueString>
            </extension>
            <extension url="name">
               <valueString value="Emergency Department Bed Occupied Stratification"></valueString>
            </extension>
            <extension url="statement">
               <valueString value="//Emergency Department Stratifier
define &quot;Emergency Department Bed Occupied Stratification&quot;:
  if &quot;ED Encounters At Location&quot; then
    'Emergency Department'
  else 'Not Emergency Department'"></valueString>
            </extension>
            <extension url="displaySequence">
               <valueInteger value="2"></valueInteger>
            </extension>
         </extension>
         <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition">
            <extension url="libraryName">
               <valueString value="BedCapacityMeasure"></valueString>
            </extension>
            <extension url="name">
               <valueString value="LocationIsHOSP"></valueString>
            </extension>
            <extension url="statement">
               <valueString value="// Simplified location type checking functions
define &quot;LocationIsHOSP&quot;:
  exists(Location.type types where types ~ &quot;HOSP&quot;)"></valueString>
            </extension>
            <extension url="displaySequence">
               <valueInteger value="3"></valueInteger>
            </extension>
         </extension>
         <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition">
            <extension url="libraryName">
               <valueString value="BedCapacityMeasure"></valueString>
            </extension>
            <extension url="name">
               <valueString value="LocationIsIRF"></valueString>
            </extension>
            <extension url="statement">
               <valueString value="define &quot;LocationIsIRF&quot;:
  exists(Location.type types where types ~ &quot;IRF&quot;)"></valueString>
            </extension>
            <extension url="displaySequence">
               <valueInteger value="4"></valueInteger>
            </extension>
         </extension>
         <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition">
            <extension url="libraryName">
               <valueString value="BedCapacityMeasure"></valueString>
            </extension>
            <extension url="name">
               <valueString value="LocationIsIPF"></valueString>
            </extension>
            <extension url="statement">
               <valueString value="define &quot;LocationIsIPF&quot;:
  exists(Location.type types where types ~ &quot;IPF&quot;)"></valueString>
            </extension>
            <extension url="displaySequence">
               <valueInteger value="5"></valueInteger>
            </extension>
         </extension>
         <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition">
            <extension url="libraryName">
               <valueString value="BedCapacityMeasure"></valueString>
            </extension>
            <extension url="name">
               <valueString value="LocationIsOTH"></valueString>
            </extension>
            <extension url="statement">
               <valueString value="define &quot;LocationIsOTH&quot;:
  exists(Location.type types where types ~ &quot;OTH&quot;)"></valueString>
            </extension>
            <extension url="displaySequence">
               <valueInteger value="6"></valueInteger>
            </extension>
         </extension>
         <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition">
            <extension url="libraryName">
               <valueString value="BedCapacityMeasure"></valueString>
            </extension>
            <extension url="name">
               <valueString value="LocationIsCHLD"></valueString>
            </extension>
            <extension url="statement">
               <valueString value="define &quot;LocationIsCHLD&quot;:
  exists(Location.type types where types ~ &quot;CHLD&quot;)"></valueString>
            </extension>
            <extension url="displaySequence">
               <valueInteger value="7"></valueInteger>
            </extension>
         </extension>
         <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition">
            <extension url="libraryName">
               <valueString value="BedCapacityMeasure"></valueString>
            </extension>
            <extension url="name">
               <valueString value="Care Level Stratification"></valueString>
            </extension>
            <extension url="statement">
               <valueString value="define &quot;Care Level Stratification&quot;:
  // Determines the level of care based on location type combinations
  case
    when &quot;LocationIsHOSP&quot; and not (&quot;LocationIsIRF&quot; or &quot;LocationIsIPF&quot; or &quot;LocationIsOTH&quot;)
      then 'ICU'
    when &quot;LocationIsHOSP&quot; and &quot;LocationIsOTH&quot;
      then 'ICU-LOC'
    when &quot;LocationIsIPF&quot; and &quot;LocationIsOTH&quot;
      then 'PCU'
    when &quot;LocationIsHOSP&quot; and &quot;LocationIsIRF&quot; and &quot;LocationIsOTH&quot;
      then 'MTMS'
    when &quot;LocationIsOTH&quot; and not (&quot;LocationIsHOSP&quot; or &quot;LocationIsIRF&quot; or &quot;LocationIsIPF&quot;)
      then 'Observation'
    when &quot;LocationIsIRF&quot; and not (&quot;LocationIsHOSP&quot; or &quot;LocationIsIPF&quot; or &quot;LocationIsOTH&quot;)
      then 'Rehabilitation'
    when &quot;LocationIsIPF&quot;
      then 'Psychiatric'
    when &quot;LocationIsIRF&quot; and &quot;LocationIsCHLD&quot;
      then 'Nursery'
    else 'Other'
  end"></valueString>
            </extension>
            <extension url="displaySequence">
               <valueInteger value="8"></valueInteger>
            </extension>
         </extension>
         <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition">
            <extension url="libraryName">
               <valueString value="BedCapacityMeasure"></valueString>
            </extension>
            <extension url="name">
               <valueString value="Bed Type Stratification"></valueString>
            </extension>
            <extension url="statement">
               <valueString value="// Value-Based Stratifiers
define &quot;Bed Type Stratification&quot;:
  // Returns the combination of location types as a concatenated string
  Combine(
    Location.type types
      return types.coding[0].code,
    '+'
  )"></valueString>
            </extension>
            <extension url="displaySequence">
               <valueInteger value="9"></valueInteger>
            </extension>
         </extension>
         <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition">
            <extension url="libraryName">
               <valueString value="BedCapacityMeasure"></valueString>
            </extension>
            <extension url="name">
               <valueString value="Age Group Stratification"></valueString>
            </extension>
            <extension url="statement">
               <valueString value="define &quot;Age Group Stratification&quot;:
  // Determines if this is adult, pediatric, or mixed based on location types
  case
    when &quot;LocationIsCHLD&quot; and not (&quot;LocationIsHOSP&quot; or &quot;LocationIsIRF&quot; or &quot;LocationIsIPF&quot;)
      then 'Pediatric'
    when &quot;LocationIsCHLD&quot; and (&quot;LocationIsHOSP&quot; or &quot;LocationIsIRF&quot; or &quot;LocationIsIPF&quot;)
      then 'Mixed'
    else 'Adult'
  end"></valueString>
            </extension>
            <extension url="displaySequence">
               <valueInteger value="10"></valueInteger>
            </extension>
         </extension>
         <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition">
            <extension url="libraryName">
               <valueString value="BedCapacityMeasure"></valueString>
            </extension>
            <extension url="name">
               <valueString value="Specialty Unit Stratification"></valueString>
            </extension>
            <extension url="statement">
               <valueString value="define &quot;Specialty Unit Stratification&quot;:
  // Identifies specific specialty units based on simplified logic
  case
    when &quot;LocationIsHOSP&quot; and &quot;LocationIsIRF&quot; and &quot;LocationIsCHLD&quot; and not &quot;LocationIsOTH&quot;
      then 'NICU-3Plus'
    when &quot;LocationIsHOSP&quot; and &quot;LocationIsIRF&quot; and &quot;LocationIsCHLD&quot; and &quot;LocationIsOTH&quot;
      then 'NICU-1'
    when &quot;LocationIsHOSP&quot; and &quot;LocationIsIRF&quot; and &quot;LocationIsOTH&quot; and not &quot;LocationIsCHLD&quot;
      then 'NICU-4'
    when &quot;LocationIsIRF&quot; and &quot;LocationIsCHLD&quot; and &quot;LocationIsOTH&quot;
      then 'OB'
    when &quot;LocationIsHOSP&quot; and &quot;LocationIsOTH&quot; and not (&quot;LocationIsIRF&quot; or &quot;LocationIsIPF&quot; or &quot;LocationIsCHLD&quot;)
      then 'Burn'
    when &quot;LocationIsHOSP&quot; and not (&quot;LocationIsIRF&quot; or &quot;LocationIsIPF&quot; or &quot;LocationIsOTH&quot; or &quot;LocationIsCHLD&quot;)
      then 'Negative-Pressure'
    else 'Standard'
  end"></valueString>
            </extension>
            <extension url="displaySequence">
               <valueInteger value="11"></valueInteger>
            </extension>
         </extension>
         <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition">
            <extension url="libraryName">
               <valueString value="BedCapacityMeasure"></valueString>
            </extension>
            <extension url="name">
               <valueString value="Surge Status Stratification"></valueString>
            </extension>
            <extension url="statement">
               <valueString value="define &quot;Surge Status Stratification&quot;:
  // Simplified surge status determination
  // Note: This may need additional Location attributes for accurate surge status
  case
    when &quot;LocationIsHOSP&quot; and &quot;LocationIsCHLD&quot; and &quot;LocationIsOTH&quot;
      then 'Surge-Active'
    else 'Standard'
  end"></valueString>
            </extension>
            <extension url="displaySequence">
               <valueInteger value="12"></valueInteger>
            </extension>
         </extension>
         <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition">
            <extension url="libraryName">
               <valueString value="FHIRHelpers"></valueString>
            </extension>
            <extension url="name">
               <valueString value="ToConcept"></valueString>
            </extension>
            <extension url="statement">
               <valueString value="define function ToConcept(concept FHIR.CodeableConcept):
    if concept is null then
        null
    else
        System.Concept {
            codes: concept.coding C return ToCode(C),
            display: concept.text.value
        }"></valueString>
            </extension>
            <extension url="displaySequence">
               <valueInteger value="13"></valueInteger>
            </extension>
         </extension>
         <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition">
            <extension url="libraryName">
               <valueString value="FHIRHelpers"></valueString>
            </extension>
            <extension url="name">
               <valueString value="ToString"></valueString>
            </extension>
            <extension url="statement">
               <valueString value="define function ToString(value string): value.value"></valueString>
            </extension>
            <extension url="displaySequence">
               <valueInteger value="14"></valueInteger>
            </extension>
         </extension>
         <name value="EffectiveDataRequirements"></name>
         <status value="active"></status>
         <type>
            <coding>
               <system value="http://terminology.hl7.org/CodeSystem/library-type"></system>
               <code value="module-definition"></code>
            </coding>
         </type>
         <relatedArtifact>
            <type value="depends-on"></type>
            <display value="Library FHIRHelpers"></display>
            <resource value="http://hl7.org/fhir/us/safr/Library/FHIRHelpers|4.0.1"></resource>
         </relatedArtifact>
         <relatedArtifact>
            <type value="depends-on"></type>
            <display value="Code system LocationPhysicalType"></display>
            <resource value="http://terminology.hl7.org/CodeSystem/location-physical-type"></resource>
         </relatedArtifact>
         <relatedArtifact>
            <type value="depends-on"></type>
            <display value="Code system HealthcareCapacity"></display>
            <resource value="http://hl7.org/fhir/us/safr/CodeSystem/us-safr-bed-capacity-example-codes"></resource>
         </relatedArtifact>
         <parameter>
            <name value="Bed Initial Population"></name>
            <use value="out"></use>
            <min value="0"></min>
            <max value="1"></max>
            <type value="boolean"></type>
         </parameter>
         <parameter>
            <name value="Occupation Stratification"></name>
            <use value="out"></use>
            <min value="0"></min>
            <max value="1"></max>
            <type value="string"></type>
         </parameter>
         <parameter>
            <name value="Emergency Department Bed Occupied Stratification"></name>
            <use value="out"></use>
            <min value="0"></min>
            <max value="1"></max>
            <type value="string"></type>
         </parameter>
         <parameter>
            <name value="Care Level Stratification"></name>
            <use value="out"></use>
            <min value="0"></min>
            <max value="1"></max>
            <type value="string"></type>
         </parameter>
         <parameter>
            <name value="Bed Type Stratification"></name>
            <use value="out"></use>
            <min value="0"></min>
            <max value="1"></max>
            <type value="string"></type>
         </parameter>
         <parameter>
            <name value="Age Group Stratification"></name>
            <use value="out"></use>
            <min value="0"></min>
            <max value="1"></max>
            <type value="string"></type>
         </parameter>
         <parameter>
            <name value="Specialty Unit Stratification"></name>
            <use value="out"></use>
            <min value="0"></min>
            <max value="1"></max>
            <type value="string"></type>
         </parameter>
         <parameter>
            <name value="Surge Status Stratification"></name>
            <use value="out"></use>
            <min value="0"></min>
            <max value="1"></max>
            <type value="string"></type>
         </parameter>
         <dataRequirement>
            <type value="Location"></type>
            <profile value="http://hl7.org/fhir/StructureDefinition/Location"></profile>
         </dataRequirement>
         <dataRequirement>
            <type value="Location"></type>
            <profile value="http://hl7.org/fhir/StructureDefinition/Location"></profile>
         </dataRequirement>
         <dataRequirement>
            <type value="Location"></type>
            <profile value="http://hl7.org/fhir/StructureDefinition/Location"></profile>
         </dataRequirement>
         <dataRequirement>
            <type value="Location"></type>
            <profile value="http://hl7.org/fhir/StructureDefinition/Location"></profile>
         </dataRequirement>
         <dataRequirement>
            <type value="Location"></type>
            <profile value="http://hl7.org/fhir/StructureDefinition/Location"></profile>
         </dataRequirement>
         <dataRequirement>
            <type value="Location"></type>
            <profile value="http://hl7.org/fhir/StructureDefinition/Location"></profile>
         </dataRequirement>
         <dataRequirement>
            <type value="Location"></type>
            <profile value="http://hl7.org/fhir/StructureDefinition/Location"></profile>
            <mustSupport value="coding"></mustSupport>
         </dataRequirement>
         <dataRequirement>
            <type value="Location"></type>
            <profile value="http://hl7.org/fhir/StructureDefinition/Location"></profile>
            <mustSupport value="coding"></mustSupport>
         </dataRequirement>
      </Library>
   </contained>
   <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-softwaresystem">
      <valueReference>
         <reference value="Device/cqf-tooling"></reference>
      </valueReference>
   </extension>
   <extension url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-populationBasis">
      <valueCode value="boolean"></valueCode>
   </extension>
   <extension id="effective-data-requirements" url="http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-effectiveDataRequirements">
      <valueReference>
         <reference value="#effective-data-requirements"></reference>
      </valueReference>
   </extension>
   <url value="http://hl7.org/fhir/us/safr/Measure/BedCapacityMeasure"></url>
   <version value="0.0.01"></version>
   <name value="BedCapacityMeasure"></name>
   <title value="Bed Capacity"></title>
   <experimental value="true"></experimental>
   <date value="2025-09-13T12:12:21-04:00"></date>
   <description value="Bed Capacity Measure includes counts of specific bed types within the context of a given healthcare context or setting."></description>
   <library value="http://hl7.org/fhir/us/safr/Library/BedCapacityMeasure"></library>
   <scoring>
      <coding>
         <system value="http://terminology.hl7.org/CodeSystem/measure-scoring"></system>
         <code value="cohort"></code>
         <display value="Cohort"></display>
      </coding>
   </scoring>
   <group>
      <population id="d2e4301">
         <code>
            <coding>
               <system value="http://terminology.hl7.org/CodeSystem/measure-population"></system>
               <code value="initial-population"></code>
               <display value="Initial Population"></display>
            </coding>
         </code>
         <criteria>
            <language value="text/cql-identifier"></language>
            <expression value="Bed Initial Population"></expression>
         </criteria>
      </population>
      <stratifier>
         <criteria>
            <language value="text/cql-identifier"></language>
            <expression value="Occupation Stratification"></expression>
         </criteria>
      </stratifier>
      <stratifier>
         <criteria>
            <language value="text/cql-identifier"></language>
            <expression value="Emergency Department Bed Occupied Stratification"></expression>
         </criteria>
      </stratifier>
      <stratifier>
         <criteria>
            <language value="text/cql-identifier"></language>
            <expression value="Bed Type Stratification"></expression>
         </criteria>
      </stratifier>
      <stratifier>
         <criteria>
            <language value="text/cql-identifier"></language>
            <expression value="Age Group Stratification"></expression>
         </criteria>
      </stratifier>
      <stratifier>
         <criteria>
            <language value="text/cql-identifier"></language>
            <expression value="Care Level Stratification"></expression>
         </criteria>
      </stratifier>
      <stratifier>
         <criteria>
            <language value="text/cql-identifier"></language>
            <expression value="Specialty Unit Stratification"></expression>
         </criteria>
      </stratifier>
      <stratifier>
         <criteria>
            <language value="text/cql-identifier"></language>
            <expression value="Surge Status Stratification"></expression>
         </criteria>
      </stratifier>
   </group>
</Measure>