flowchart RL

%% -------------------------
%% Groups (PlantUML packages)
%% -------------------------
subgraph HF4["Healthcare Facility Four"]
  EHR4["Data Source (EHR)"]
end

subgraph HF3["Healthcare Facility Three"]
  EHR3["Data Source (EHR)"]
end

subgraph HF2["Healthcare Facility Two"]
  EHR2["Data Source (EHR)"]
end

subgraph HF1["Healthcare Facility One"]
  EHR1["Data Source (EHR)"]
end

subgraph J1["Jurisdiction One"]
  MEE1["Measure Evaluation Engine"]
  Recipient1["MeasureReport Recipient"]
  DA1["Data Aggregator"]
end

subgraph J2["Jurisdiction Two"]
  MEE2["Measure Evaluation Engine"]
  Recipient2["MeasureReport Recipient"]
end

subgraph NHSN["NHSN"]
  MS["Measure Source"]
  NHSN_Recipient["MeasureReport Recipient and Other NHSN Systems"]
end

%% -----------------------------------------
%% Hidden-ish layout nudges (Mermaid trick)
%% (Mermaid doesn't have true hidden edges,
%%  so we use an invisible link style)
%% -----------------------------------------
EHR4 --- EHR3
EHR3 --- EHR2
EHR2 --- EHR1
EHR1 --- MEE1
MEE1 --- MEE2
MEE2 --- MS
MS --- NHSN_Recipient

linkStyle 0,1,2,3,4,5,6 stroke-width:0,opacity:0;

%% -------------
%% Flows
%% -------------

%% (1) Retrieve Measures
MEE1 -->|"(1)<br/>Retrieve Measure Bundle"| MS
MEE2 -->|"(1)<br/>Retrieve Measure Bundle"| MS

%% (2) Query data sources
DA1 -->|"(2)<br/>Query Data Source"| EHR1
DA1 -->|"(2)<br/>Query Data Source"| EHR2
MEE2 -->|"(2)<br/>Query Data Source"| EHR3
MEE2 -->|"(2)<br/>Query Data Source"| EHR4

%% (2) Aggregate
DA1 -->|"(2)<br/>Aggregate Data<br/>via FHIR or other API"| MEE1

%% (3) Submit to jurisdiction recipients
MEE1 -->|"(3)<br/>Submit MeasureReport Bundle"| Recipient1
MEE2 -->|"(3)<br/>Submit MeasureReport Bundle"| Recipient2

%% (4) Submit to NHSN
MEE1 -->|"(4)<br/>Submit MeasureReport Bundle"| NHSN_Recipient
MEE2 -->|"(4)<br/>Submit MeasureReport Bundle"| NHSN_Recipient